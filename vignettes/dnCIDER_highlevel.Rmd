---
title: "Perform dnCIDER (high-level) on pancreas data"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Perform dnCIDER (high-level) on pancreas data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


# Introduction

This vignette performs dnCIDER on a cross-species pancreas dataset.


# Set up

In addition to **CIDER**, we will load the following packages:

```{r setup}
library(CIDER)
library(Seurat)
library(parallel)
library(cowplot)
```

# Load example data

Pancreatic cell data$^1$ contain cells from human (8241 cells) and mouse (1886 cells).

```{r} 
data("pancreas_counts") # count matrix
data("pancreas_meta") # meta data/cell information
seu <- CreateSeuratObject(counts = pancreas_counts, meta.data = pancreas_meta)
table(seu$Batch)
```

# Perform dnCIDER (high-level)

```{r}
seu <- initialClustering(seu, additional.vars.to.regress = "Sample", dims = 1:15)
ider <- getIDEr(seu, downsampling.size = 35, use.parallel = TRUE, verbose = FALSE)
seu <- finalClustering(seu, ider, cutree.h = 0.35) # final clustering
```

```{r seurat-pipeline}
seu <- NormalizeData(seu, verbose = FALSE)
seu <- FindVariableFeatures(seu, selection.method = "vst", nfeatures = 2000, verbose = FALSE)
seu <- ScaleData(seu, verbose = FALSE)
seu <- RunPCA(seu, npcs = 20, verbose = FALSE)
seu <- RunTSNE(seu, reduction = "pca", dims = 1:12)
```

```{r tsne-plot-CIDER-results, fig.height=3, fig.width=7}
plot_list <- list()
plot_list[[1]] <- scatterPlot(seu, "tsne", colour.by = "CIDER_cluster", title = "asCIDER clustering results") 
plot_list[[2]] <- scatterPlot(seu, "tsne", colour.by = "Group", title = "Ground truth of cell populations") 
plot_grid(plotlist = plot_list, ncol = 2)
```

# References

1. Baron, M. et al. A Single-Cell Transcriptomic Map of the Human and Mouse Pancreas Reveals Inter- and Intra-cell Population Structure. Cell Syst 3, 346â€“360.e4 (2016).
2. Satija R, et al. Spatial reconstruction of single-cell gene expression data. Nature Biotechnology 33, 495-502 (2015). 


